{
  "name" : "Tensorflow Devcontainer",
  // "image": "tensorflow/tensorflow:2.16.1-gpu", // If you don't want to build the image yourself, you can use this pre-built image.

  "dockerComposeFile" : [
    "../docker-compose.yml"
  ],

  "service": "app",
  
  "updateContentCommand" : {
    // Runs once after the container is created and your source code is cloned or mounted, but before postCreateCommand executes. 
    // It's specifically intended for tasks that need to happen after the source code is present but before general setup, 
    // like updating submodules or installing dependencies based on the just-cloned code.
    // "install dev tools" : "bash .devcontainer/install-dev-tools.sh"
  },

  "postCreateCommand" : {
    // Executes once after the container is created, but before VS Code connects. 
    // This is ideal for one-time setup tasks like installing dependencies, cloning repos, or initializing databases.
  },

  "postStartCommand" : {
    // Executes every time the container starts, before VS Code connects. 
    // Useful for tasks that need to run each time the container boots, like starting background services.
  },

  "postAttachCommand" : {
    // Executes every time you attach VS Code to the container (including window reloads), after VS Code connects. 
    // Good for commands specific to your VS Code session, like starting a development server in the integrated terminal.
    "test nvidia" : "nvidia-smi",
    "test nvcc" : "nvcc --version",
    "check python version" : "python3 --version",
    "check tensorflow" : "python3 -c \"import tensorflow as tf; print(f'TensorFlow Version: {tf.__version__}'); gpus = tf.config.list_physical_devices('GPU'); print(f'Found GPUs: {gpus}'); assert len(gpus) > 0, 'ERROR: No GPU detected'\"",
    "test tensorflow" : "python3 /workspaces/devcontainer_test/src/test_tensorflow_gpu_access.py"
  },

  // Customizations for VS Code. These are largely optional, but included here are some popular extensions for additional functionality and convenience.
  "customizations" : {
    "vscode" : {
      "extensions" : [
        // ms-python.python" is for Python development
        "ms-python.python",

        // ms-toolsai.jupyter is for Jupyter notebook support
        "ms-toolsai.jupyter",
        
        // ms-toolsai.vscode-jupyter-cell-tags is for Jupyter cell tags
        "ms-toolsai.vscode-jupyter-cell-tags",
        
        // ms-toolsai.jupyter-keymap is for Jupyter keybindings
        "ms-toolsai.jupyter-keymap",
        
        // ms-toolsai.jupyter-renderers is for Jupyter renderers
        "ms-toolsai.jupyter-renderers",
        
        // ms-toolsai.vscode-jupyter-slideshow is for Jupyter slideshow presentations
        "ms-toolsai.vscode-jupyter-slideshow",
        
        // ms-python.vscode-pylance is for Python language support
        "ms-python.vscode-pylance",
        
        // Google Gemini Code Assist as another option instead of Copilot
        "google.geminicodeassist",

        // Autopep8 for Python code formatting
        "ms-python.autopep8"
      ]
    }
  }
}